<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="">
		<meta name="author" content="">
		<title>
		【转】jstat的用法
		</title>
		<!-- Bootstrap Core CSS -->
		<link href="/css/bootstrap.min.css" rel="stylesheet">
		<!-- Custom CSS -->
		<link href="/css/blog.css" rel="stylesheet">
		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media
		queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file://
		-->
		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js">
		</script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js">
		</script>
		<![endif]-->
	</head>
	<body>
		<!-- Navigation -->
		<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
		<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
		<span class="sr-only">
		Toggle navigation
		</span>
		<span class="icon-bar">
		</span>
		<span class="icon-bar">
		</span>
		<span class="icon-bar">
		</span>
		</button>
		<a class="navbar-brand" href="/index.html">
		Jarvis的博客
		</a>
		</div>
		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
		<ul class="nav navbar-nav">
		<li>
		<a href="/archives.html">
		归 档
		</a>
		</li>
		<li>
		<a href="/categories.html">
		分 类
		</a>
		</li>
		<li>
		<a href="/about.html">
		关 于
		</a>
		</li>
		</ul>
		</div>
		<!-- /.navbar-collapse -->
		</div>
		<!-- /.container -->
		</nav>
		<!-- Page Content -->
		<div class="container">
		<div class="row">
		<!-- Blog Entries Column -->
		<div class="col-md-8">
		<!-- Blog Post -->
<!-- Title -->
<h2>
  【转】jstat的用法
  <div class="post-date">
	<span class="glyphicon glyphicon-time"></span>
	22 Jan 2014
  </div>
</h2>
<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more">分享到：</a><a title="分享到QQ空间" href="#" class="bds_qzone" data-cmd="qzone">QQ空间</a><a title="分享到新浪微博" href="#" class="bds_tsina" data-cmd="tsina">新浪微博</a><a title="分享到腾讯微博" href="#" class="bds_tqq" data-cmd="tqq">腾讯微博</a><a title="分享到人人网" href="#" class="bds_renren" data-cmd="renren">人人网</a><a title="分享到微信" href="#" class="bds_weixin" data-cmd="weixin">微信</a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{"bdSize":16},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
<!-- Author -->
<hr>

<p>如何判断JVM是否存在内存问题呢？如何判断JVM垃圾回收是否正常？一般的top指令基本上满足不了这样的需求，因为它主要监控的是总体的系统资源，很难定位到java应用程序。</p>

<p>Jstat是JDK自带的一个轻量级小工具。全称“Java Virtual Machine statistics monitoring tool”，它位于java的bin目录下，主要利用JVM内建的指令对Java应用程序的资源和性能进行实时的命令行的监控，包括了对Heap size和垃圾回收状况的监控。可见，Jstat是轻量级的、专门针对JVM的工具，非常适用。由于JVM内存设置较大，图中百分比变化不太明显
一个极强的监视VM内存工具。可以用来监视VM内存内的各种堆和非堆的大小及其内存使用量。</p>

<p>jstat工具特别强大，有众多的可选项，详细查看堆内各个部分的使用量，以及加载类的数量。使用时，需加上查看进程的进程id，和所选参数。
执行：cd $JAVA_HOME/bin中执行jstat，注意jstat后一定要跟参数。</p>

<p>语法结构：</p>

<pre><code>Usage: jstat -help|-options
       jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]]
</code></pre>

<p>参数解释：</p>

<p>Options — 选项，我们一般使用 -gcutil 查看gc情况<br />
vmid    — VM的进程号，即当前运行的java进程号<br />
interval– 间隔时间，单位为秒或者毫秒<br />
count   — 打印次数，如果缺省则打印无数次  </p>

<p>S0  — Heap上的 Survivor space 0 区已使用空间的百分比<br />
S1  — Heap上的 Survivor space 1 区已使用空间的百分比<br />
E   — Heap上的 Eden space 区已使用空间的百分比<br />
O   — Heap上的 Old space 区已使用空间的百分比<br />
P   — Perm space 区已使用空间的百分比<br />
YGC — 从应用程序启动到采样时发生 Young GC 的次数<br />
YGCT– 从应用程序启动到采样时 Young GC 所用的时间(单位秒)<br />
FGC — 从应用程序启动到采样时发生 Full GC 的次数<br />
FGCT– 从应用程序启动到采样时 Full GC 所用的时间(单位秒)<br />
GCT — 从应用程序启动到采样时用于垃圾回收的总时间(单位秒)  </p>

<p><strong>实例使用1：</strong></p>

<pre><code>[root@localhost bin]# jstat -gcutil 25444
  S0     S1     E      O      P     YGC     YGCT    FGC    FGCT     GCT
 11.63   0.00   56.46  66.92  98.49 162    0.248    6      0.331    0.579
</code></pre>

<!--break-->

<table>
  <tbody>
    <tr>
      <td><strong>实例使用2：</strong>(25444是java的进程号，ps -ef</td>
      <td>grep java)</td>
    </tr>
  </tbody>
</table>

<pre><code>[root@localhost bin]# jstat -gcutil 25444 1000 5
  S0     S1     E      O      P     YGC     YGCT    FGC    FGCT     GCT
 73.54   0.00  99.04  67.52  98.49    166    0.252     6    0.331    0.583
 73.54   0.00  99.04  67.52  98.49    166    0.252     6    0.331    0.583
 73.54   0.00  99.04  67.52  98.49    166    0.252     6    0.331    0.583
 73.54   0.00  99.04  67.52  98.49    166    0.252     6    0.331    0.583
 73.54   0.00  99.04  67.52  98.49    166    0.252     6    0.331    0.583
</code></pre>

<p>我们可以看到，5次young gc之后，垃圾内存被从Eden space区(E)放入了Old space区(O)，并引起了百分比的变化，导致Survivor space使用的百分比从73.54%(S0)降到0%(S1)。有效释放了内存空间。绿框中，我们可以看到，一次full gc之后，Old space区(O)的内存被回收，从99.05%降到67.52%。
图中同时打印了young gc和full gc的总次数、总耗时。而，每次young gc消耗的时间，可以用相间隔的两行YGCT相减得到。每次full gc消耗的时间，可以用相隔的两行FGCT相减得到。例如红框中表示的第一行、第二行之间发生了1次young gc，消耗的时间为0.252-0.252＝0.0秒。
常驻内存区(P)的使用率，始终停留在98.49%左右，说明常驻内存没有突变，比较正常。
如果young gc和full gc能够正常发生，而且都能有效回收内存，常驻内存区变化不明显，则说明java内存释放情况正常，垃圾回收及时，java内存泄露的几率就会大大降低。但也不能说明一定没有内存泄露。
GCT 是YGCT 和FGCT的时间总和。
以上，介绍了Jstat按百分比查看gc情况的功能。其实，它还有功能，例如加载类信息统计功能、内存池信息统计功能等，那些是以绝对值的形式打印出来的，比较少用，在此就不做介绍。</p>

<pre><code>[root@localhost bin]# ps -ef | grep java
root     25917     1  2 23:23 pts/2    00:00:05 /usr/local/jdk1.5/bin/java -Djava.endorsed.dirs=/usr/local/jakarta-tomcat-5.0.30/common/endorsed -classpath /usr/local/jdk1.5/lib/tools.jar:/usr/local/jakarta-tomcat-5.0.30/bin/bootstrap.jar:/usr/local/jakarta-tomcat-5.0.30/bin/commons-logging-api.jar -Dcatalina.base=/usr/local/jakarta-tomcat-5.0.30 -Dcatalina.home=/usr/local/jakarta-tomcat-5.0.30 -Djava.io.tmpdir=/usr/local/jakarta-tomcat-5.0.30/temp org.apache.catalina.startup.Bootstrap start
</code></pre>

<p>jstat -class pid:显示加载class的数量，及所占空间等信息。 </p>

<p><strong>实例使用3：</strong></p>

<pre><code>[root@localhost bin]# jstat -class 25917
Loaded  Bytes  Unloaded  Bytes     Time
2629    2916.8       29   24.6     0.90
</code></pre>

<p>jstat -compiler pid:显示VM实时编译的数量等信息。  </p>

<p><strong>实例使用4：</strong></p>

<pre><code>[root@localhost bin]# jstat -compiler 25917
Compiled Failed Invalid   Time   FailedType FailedMethod
     768      0       0   0.70            0
</code></pre>

<p>jstat –gccapacity :可以显示，VM内存中三代（young,old,perm）对象的使用和占用大小，如：PGCMN显示的是最小perm的内存使用量，PGCMX显示的是perm的内存最大使用量，PGC是当前新生成的perm内存占用量，PC是但前perm内存占用量。其他的可以根据这个类推， OC是old内纯的占用量。</p>

<pre><code>[root@localhost bin]# jstat -gccapacity 25917
NGCMN       640.0
NGCMX       4992.0
NGC         832.0
S0C         64.0
S1C         64.0
EC          704.0
OGCMN       1408.0
OGCMX       60544.0
OGC         9504.0
OC          9504.0                  OC是old内纯的占用量
PGCMN       8192.0                  PGCMN显示的是最小perm的内存使用量
PGCMX       65536.0                 PGCMX显示的是perm的内存最大使用量
PGC         12800.0                 PGC是当前新生成的perm内存占用量
PC          12800.0                 PC是但前perm内存占用量
YGC         164
FGC         6
</code></pre>

<p>jstat -gcnew pid: new对象的信息</p>

<pre><code>[root@localhost bin]# jstat -gcnew 25917
 S0C    S1C    S0U    S1U   TT MTT  DSS      EC       EU     YGC     YGCT
 64.0   64.0   47.4   0.0   2  15   32.0    704.0    145.7    168    0.254
</code></pre>

<p>jstat -gcnewcapacity pid: new对象的信息及其占用量</p>

<pre><code>[root@localhost bin]# jstat -gcnewcapacity 25917
 NGCMN  NGCMX   NGC   S0CMX  S0C   S1CMX  S1C   ECMX    EC      YGC   FGC
640.0  4992.0  832.0 64.0   448.0 448.0  64.0   4096.0  704.0  168     6
</code></pre>

<p>jstat -gcold pid: old对象的信息。</p>

<pre><code>[root@localhost bin]# jstat -gcold 25917
   PC       PU        OC          OU       YGC    FGC    FGCT     GCT
 12800.0  12617.6     9504.0      6561.3   169     6    0.335    0.591
</code></pre>

<p>jstat -gcoldcapacity pid:old对象的信息及其占用量。</p>

<pre><code>[root@localhost bin]# jstat -gcoldcapacity 25917
OGCMN      OGCMX        OGC         OC       YGC   FGC    FGCT     GCT
1408.0     60544.0      9504.0      9504.0   169     6    0.335    0.591
</code></pre>

<p>jstat -gcpermcapacity pid: perm对象的信息及其占用量。</p>

<pre><code>[root@localhost bin]# jstat -gcpermcapacity 25917
PGCMN      PGCMX       PGC         PC      YGC   FGC    FGCT     GCT
8192.0    65536.0    12800.0    12800.0   169     6    0.335    0.591
</code></pre>

<p>jstat -printcompilation pid:当前VM执行的信息。</p>

<pre><code>[root@localhost bin]# jstat -printcompilation -h3  25917 1000 5
每1000毫秒打印一次，一共打印5次，还可以加上-h3每三行显示一下标题。
Compiled  Size  Type Method
     788     73    1 java/io/File &lt;init&gt;
     788     73    1 java/io/File &lt;init&gt;
     788     73    1 java/io/File &lt;init&gt;
Compiled  Size  Type Method
     788     73    1 java/io/File &lt;init&gt;
     788     73    1 java/io/File &lt;init&gt;
</code></pre>


<a href="http://www.51testing.com/html/92/77492-203728.html" target="_blank">原文地址</a>

<br/>
<br/>
<div style="margin-top:10px;margin-bottom:10px">
  
  <span class="next">
    上篇：
    <a href="/linux/2013/08/12/linux-log-analysis.html">
      【转】应知应会：在linux/unix上分析程序日志的技巧
    </a>
  </span>
   
  
  <span class="prev">
    下篇：
    <a href="/linux/2014/04/15/linux-shell-str-operation.html">
      【转】linux shell 字符串操作（长度，查找，替换，匹配）详解
    </a>
  </span>
  
</div>
<hr>
<!-- 多说评论框 start -->
  <div class="ds-thread" data-thread-key="【转】jstat的用法" data-title="【转】jstat的用法" data-url="/java/2014/01/22/jstat-usage.html"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"jarvisk"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共JS代码 end -->

		</div>
		<!-- Blog Sidebar Widgets Column -->
		<div class="col-md-4">
		<!-- Blog Search Well -->
		<div class="well">
            <h4>
              站内搜索
            </h4>
            <!--Baidu站内搜索开始-->
			<form action="http://www.baidu.com/baidu">
			<input type=text name=word>
			<input type="submit" value="搜索">
			<input name=tn type=hidden value="bds">
			<input name=cl type=hidden value="3">
			<input name=ct type=hidden value="2097152">
			<input name=si type=hidden value="www.jarvisk.com">
			</form>
			<!--Baidu站内搜索结束-->
            <!-- /.input-group -->
          </div>
		<!-- Blog Categories Well -->
		<div class="well">
		<h4>
		分 类
		</h4>
		<div class="row">
		<div class="col-lg-6">
		<ul class="list-unstyled">
		<li>
			<a href="/categories.html#scifi">科幻小说</a>
		</li>
		<li>
			<a href="/categories.html#linux">linux</a>
		</li>
		<li>
			<a href="/categories.html#java">java</a>
		</li>
		<li>
			<a href="/categories.html#mysql">mysql</a>
		</li>
		<li>
			<a href="/categories.html#maven">maven</a>
		</li>
		</ul>
		</div>
		<!-- /.col-lg-6 -->
		</div>
		<!-- /.row -->
		</div>

		</div>
		</div>
		</div>
		<!-- /.row -->
		<hr>
		<!-- Footer -->
		<footer>
		<div class="row">
		<div class="col-lg-12">
		<p align="center">
		Copyright &copy; www.jarvisk.com 2014, powered by Jekyll and GitPages.
		</p>
		</div>
		<!-- /.col-lg-12 -->
		</div>
		<!-- /.row -->
		</footer>
		</div>
		<!-- /.container -->
		<!-- jQuery Version 1.11.0 -->
		<script src="js/jquery-1.11.0.js">
		</script>
		<!-- Bootstrap Core JavaScript -->
		<script src="js/bootstrap.min.js">
		</script>
		<script type="text/javascript">
		var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
		document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fc09ef89ffb783591c2e6f98a1d564325' type='text/javascript'%3E%3C/script%3E"));
		</script>

		
	</body>
</html>